{"componentChunkName":"component---src-templates-blog-post-js","path":"/exposing-your-app-in-kubernetes/","webpackCompilationHash":"6bde7340039fbc964ded","result":{"data":{"site":{"siteMetadata":{"title":"tech-blog","author":"Alamgir Qazi"}},"markdownRemark":{"id":"687b6925-2d19-5802-a688-ccc1396cdb93","excerpt":"Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications built by Google…","html":"<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/0a443/kubernetes.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.018229166666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAd6ZyUawCv/EABoQAAICAwAAAAAAAAAAAAAAAAARATECAxL/2gAIAQEAAQUClrV0zOos/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/ATV//8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ARF//8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAECExYf/aAAgBAQAGPwIrcy12xX//xAAaEAACAgMAAAAAAAAAAAAAAAAQIQBxMUFh/9oACAEBAAE/IaoUb0n2Mdnf/9oADAMBAAIAAwAAABBYD//EABURAQEAAAAAAAAAAAAAAAAAABAx/9oACAEDAQE/EIH/xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCh/8QAHRAAAQQCAwAAAAAAAAAAAAAAARARITEAQVHw8f/aAAgBAQABPxDQZJctGexp11lgjebCf//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Kubernetes\"\n        title=\"\"\n        src=\"/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/c739e/kubernetes.jpg\"\n        srcset=\"/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/8ee9c/kubernetes.jpg 148w,\n/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/ebbe7/kubernetes.jpg 295w,\n/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/c739e/kubernetes.jpg 590w,\n/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/5413e/kubernetes.jpg 885w,\n/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/4efde/kubernetes.jpg 1180w,\n/tech-blog/static/50d20da9d7a68b328a5dbbb5691ecadb/0a443/kubernetes.jpg 1536w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications built by Google. Kubernetes has now become the leader in container orchestration.</p>\n<p>There are different ways we can expose our Kubernetes Deployments.</p>\n<h3>1. Load Balancer</h3>\n<p>Kubernetes provides a simple HTTPS L7 Load Balancer. In order to expose a deployment, run this command in Kubectl. Here, myapp is our deployment which is available via ClusterIP but isn’t exposed to the outside world.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">kubectl expose deployment myapp <span class=\"token operator\">-</span> type<span class=\"token operator\">=</span><span class=\"token string\">\"LoadBalancer\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3>2. Ingress</h3>\n<p>Ingress can be considered as a fancier Load Balancer with more configurations. In Kubernetes Engine, Ingress is implemented using Cloud Load Balancing. When you create an Ingress in your cluster, Kubernetes Engine creates an HTTP(S) load balancer and configures it to route traffic to your application. We can set up several rules for our load balancer. Ingress can also help in exposing multiple services via a single host endpoint with different URLs.</p>\n<p>In order to set up Ingress, we need to do 2 things.</p>\n<ol>\n<li>Reserve a static IP on Google Cloud.</li>\n<li>set up SSL of our domain. (needed if you want to expose to a custom domain e.g myapp.com instead of a reserved IP address).</li>\n</ol>\n<p>Step 1:</p>\n<p>Run the following command and make sure you have Google Cloud SDK (<a href=\"https://cloud.google.com/sdk/\">https://cloud.google.com/sdk/</a>) installed and configured.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">gcloud compute addresses create kubernetes<span class=\"token operator\">-</span>ingress <span class=\"token operator\">-</span> region us<span class=\"token operator\">-</span>central1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This will reserve a static IP with the name kubernetes-ingress.</p>\n<p>Step 2:</p>\n<p>Download the private key for your custom domain.</p>\n<p>Run the following command to generate the RSA Private key</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">openssl rsa <span class=\"token operator\">-</span><span class=\"token keyword\">in</span> <span class=\"token keyword\">private</span><span class=\"token punctuation\">.</span>key <span class=\"token operator\">-</span>out private_rsa<span class=\"token punctuation\">.</span>key</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>if you get passphrase error, run this</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">openssl rsa <span class=\"token operator\">-</span><span class=\"token keyword\">in</span> privateKey<span class=\"token punctuation\">.</span>pem <span class=\"token operator\">-</span>out newPrivateKey<span class=\"token punctuation\">.</span>pem</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Now run:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">kubectl create secret tls ingress<span class=\"token operator\">-</span>ssl <span class=\"token operator\">-</span> key private_rsa<span class=\"token punctuation\">.</span>key <span class=\"token operator\">-</span> cert mycert<span class=\"token punctuation\">.</span>crt</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This will create an SSL configuration named ingress-ssl. We will use this configuration for our Ingress.</p>\n<p>Here’s a yaml configuration file for Kubernetes Ingress. This yaml file can be deployed.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">apiVersion<span class=\"token punctuation\">:</span> extensions<span class=\"token operator\">/</span>v1beta1\nkind<span class=\"token punctuation\">:</span> Ingress\nmetadata<span class=\"token punctuation\">:</span>\nname<span class=\"token punctuation\">:</span> kubernetes<span class=\"token operator\">-</span>ingress\n# kubernetes<span class=\"token operator\">-</span>ingress is the name <span class=\"token keyword\">of</span> <span class=\"token keyword\">static</span> ip we've reserved <span class=\"token keyword\">in</span> #Google Cloud\nannotations<span class=\"token punctuation\">:</span>\nkubernetes<span class=\"token punctuation\">.</span>io<span class=\"token operator\">/</span>ingress<span class=\"token punctuation\">.</span>global<span class=\"token operator\">-</span><span class=\"token keyword\">static</span><span class=\"token operator\">-</span>ip<span class=\"token operator\">-</span>name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"kubernetes-ingress\"</span>\nspec<span class=\"token punctuation\">:</span>\ntls<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> hosts<span class=\"token punctuation\">:</span>\n<span class=\"token operator\">-</span> myapp<span class=\"token punctuation\">.</span>com\nsecretName<span class=\"token punctuation\">:</span> ingress<span class=\"token operator\">-</span>ssl\nbackend<span class=\"token punctuation\">:</span>\nserviceName<span class=\"token punctuation\">:</span> myapp\nservicePort<span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>3. Port-Forward</h3>\n<p>Port-forward basically exposes a service running in Kubernetes cluster and maps it to a local port on your computer. The below command is an example. It exposes my service prometheus from namespace ‘monitoring’ and it maps it to localhost:8082. This can be ideal for testing purposes and for services that you do not want to expose to the outside world but might need for testing for your own.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 0\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">kubectl port<span class=\"token operator\">-</span>forward svc<span class=\"token operator\">/</span>prometheus <span class=\"token operator\">-</span> namespace monitoring <span class=\"token number\">8082</span><span class=\"token punctuation\">:</span><span class=\"token number\">9090</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Which one should you use?</p>\n<p>Load Balancer is ideal if you are testing and only have a single service that you want to expose. Mostly this is not the case and thus this can become expensive.</p>\n<p>Port-Forward is mostly for testing locally and not an option to expose for production.</p>\n<p>Ingress is the most likely solution as it provides more customization and offers much more.</p>\n<p>There are also other ways to expose your Kubernetes service. Have a look at Istio (a service mesh) or an API Gateway like (Express-gateway for Node.js).</p>","frontmatter":{"title":"Exposing your app in Kubernetes","date":"November 08, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/exposing-your-app-in-kubernetes/","previous":null,"next":{"fields":{"slug":"/introduction-to-containers-and-docker/"},"frontmatter":{"title":"Introduction to Containers and Docker"}}}}}